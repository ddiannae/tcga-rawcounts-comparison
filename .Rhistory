merged.annot[merged.annot$EnsemblId == "ENSG00000169618", ]
merged.annot[merged.annot$EntrezId == "10887", ]
merged.annot[merged.annot$EnsemblId == "ENSG00000144134" & merged.annot$EntrezId == "11159", ]
merged.annot["13253",] <- merged.annot["13254",]
merged.annot[merged.annot$EnsemblId == "ENSG00000144134", ]
merged.annot[merged.annot$EntrezId == merged.annot["13253", "EntrezId"], ]
merged.annot[merged.annot$EnsemblId == "ENSG00000188092" & merged.annot$EntrezId == "51463", ]
merged.annot["6879",] <- merged.annot["6880",]
merged.annot[merged.annot$EnsemblId == "ENSG00000188092", ]
merged.annot[merged.annot$EntrezId == merged.annot["6879", "EntrezId"], ]
merged.annot[merged.annot$EnsemblId == "ENSG00000187272" & merged.annot$EntrezId == "83901", ]
merged.annot["8772",] <- merged.annot["8771",]
merged.annot[merged.annot$EntrezId == merged.annot["8772", "EntrezId"] , ]
merged.annot[merged.annot$EnsemblId == "ENSG00000187272", ]
merged.annot[merged.annot$EnsemblId == "ENSG00000182986" & merged.annot$EntrezId == "162967", ]
merged.annot["18208",] <- merged.annot["18207",]
merged.annot[merged.annot$EnsemblId == "ENSG00000182986", ]
merged.annot[merged.annot$EntrezId == merged.annot["18208", "EntrezId"], ]
merged.annot[merged.annot$EnsemblId == "ENSG00000158427" & merged.annot$EntrezId == "286527", ]
merged.annot["16591",] <- merged.annot["16592",]
merged.annot[merged.annot$EntrezId == merged.annot["16591", "EntrezId"], ]
merged.annot["16593",] <- merged.annot["16592",]
merged.annot[merged.annot$EnsemblId == "ENSG00000158427", ]
merged.annot[merged.annot$EnsemblId == "ENSG00000238269" & merged.annot$EntrezId == "389860", ]
merged.annot["11643",] <- merged.annot["11644",]
merged.annot[merged.annot$EnsemblId == "ENSG00000238269", ]
merged.annot[merged.annot$EntrezId == merged.annot["11643", "EntrezId"] , ]
merged.annot[merged.annot$EnsemblId == "ENSG00000278299" & merged.annot$EntrezId == "414060", ]
merged.annot["15942",] <- merged.annot["15943",]
merged.annot[merged.annot$EnsemblId == "ENSG00000278299", ]
merged.annot[merged.annot$EntrezId == merged.annot["15942", "EntrezId"] , ]
merged.annot[merged.annot$EnsemblId == "ENSG00000268940" & merged.annot$EntrezId == "541466", ]
merged.annot["4078",] <- merged.annot["4077",]
merged.annot[merged.annot$EnsemblId == "ENSG00000268940", ]
merged.annot[merged.annot$EntrezId == merged.annot["4078", "EntrezId"], ]
merged.annot[merged.annot$EnsemblId == "ENSG00000183474" & merged.annot$EntrezId == "728340", ]
merged.annot["7026",] <- merged.annot["7025",]
merged.annot[merged.annot$EntrezId == merged.annot["7026", "EntrezId"] , ]
merged.annot[merged.annot$EnsemblId == "ENSG00000183474", ]
merged.annot[merged.annot$EnsemblId == "ENSG00000099974" & merged.annot$EntrezId == "100037417", ]
merged.annot["4448",] <- merged.annot["4449",]
merged.annot[merged.annot$EnsemblId == "ENSG00000099974", ]
merged.annot[merged.annot$EntrezId == merged.annot["4448", "EntrezId"], ]
all(lapply(as.character(merged.annot$EnsemblId), nchar) == 15)
### Duplicates Ensambl Take 3
merged.annot[duplicated(merged.annot), ]
merged.annot <- merged.annot[!duplicated(merged.annot), ]
dim(merged.annot)
dup.ensembl.ids <- which(duplicated(merged.annot$EnsemblId))
dup.ensembl <-unique(merged.annot[dup.ensembl.ids, "EnsemblId"])
dup.ensembl.rows <- merged.annot[which(merged.annot$EnsemblId %in% dup.ensembl), ]
dim(dup.ensembl.rows)
### [1] 16  9
length(unique(dup.ensembl.rows$EntrezId))
dup.ensembl.rows <- dup.ensembl.rows[order(dup.ensembl.rows$EnsemblId, dup.ensembl.rows$EntrezId), ]
### Duplicated EntrezId
dup.entrez.ids <-which(duplicated(merged.annot$EntrezId))
dup.entrez <- unique(merged.annot[dup.entrez.ids, "EntrezId"])
dup.entrez.rows <- merged.annot[which(merged.annot$EntrezId %in% dup.entrez), ]
dim(dup.entrez.rows)
##write.table(dup.entrez.rows, file = "dup_entrez_rows.tsv", quote=F, sep="\t")
## check manually
ids.to.remove = c("910", "943", "2810", "3957", "4502", "7497", "7758", "8027", "9281", "10507",
"11773", "11904", "11918", "12137", "13275", "13279", "14205", "14234", "14382",
"15945", "16258", "16400", "17924", "18185")
merged.annot[ids.to.remove, ]
merged.annot <- merged.annot[!(rownames(merged.annot) %in% ids.to.remove), ]
dim(merged.annot)
##[1] 18581     9
## Keep the smallest ensemblIds for duplicated entrez
merged.annot$Row <- 1:nrow(merged.annot)
merged.annot <- merged.annot[order(merged.annot$EntrezId, merged.annot$EnsemblId), ]
dup.entrez.ids <-which(duplicated(merged.annot$EntrezId))
length(dup.entrez.ids)
## [1] 10
merged.annot[dup.entrez.ids, ]
merged.annot <- merged.annot[-dup.entrez.ids, ]
dim(merged.annot)
##[1] 18571     9
which(duplicated(merged.annot$EntrezId))
### Before summing the counts for duplicated ensemblIds, remove all the unwanted EntrezId in
### normal.df and tumor.df
tumor.df <- tumor.df[rownames(tumor.df) %in% merged.annot$EntrezId, ]
dim(tumor.df)
## [1] 18571   773
normal.df <- normal.df[rownames(normal.df) %in% merged.annot$EntrezId, ]
dim(normal.df)
rnames.tumor <- rownames(tumor.df)
rnames.normal <- rownames(normal.df)
sum.counts.tumor <- tumor.df[rnames.tumor == "23637", ] + tumor.df[rnames.tumor == "2844", ]
tumor.df[rnames.tumor == "23637", ] <- sum.counts.tumor
sum.counts.normal <- normal.df[rnames.normal == "23637", ] +  normal.df[rnames.normal == "2844", ]
normal.df[rnames.normal == "23637", ] <- sum.counts.normal
sum.counts.tumor  <- tumor.df[rnames.tumor == "23499", ] + tumor.df[rnames.tumor == "643314", ]
tumor.df[rnames.tumor == "23499", ] <- sum.counts.tumor
sum.counts.normal <- normal.df[rnames.normal == "23499", ] + normal.df[rnames.normal == "643314", ]
normal.df[rnames.normal == "23499", ] <- sum.counts.normal
head(merged.annot)
sum.counts.tumor  <- tumor.df[rnames.tumor == "26290", ] + tumor.df[rnames.tumor == "3742", ]
tumor.df[rnames.tumor == "26290", ] <- sum.counts.tumor
sum.counts.normal <- normal.df[rnames.normal == "26290", ] + normal.df[rnames.normal == "3742", ]
normal.df[rnames.normal == "26290", ] <- sum.counts.normal
sum.counts.tumor  <- tumor.df[rnames.tumor == "84953", ] + tumor.df[rnames.tumor == "9645", ]
tumor.df[rnames.tumor == "84953", ] <- sum.counts.tumor
sum.counts.normal <- normal.df[rnames.normal == "84953", ] + normal.df[rnames.normal == "9645", ]
normal.df[rnames.normal == "84953", ] <- sum.counts.normal
sum.counts.tumor  <- tumor.df[rnames.tumor == "285464", ] + tumor.df[rnames.tumor == "57654", ]
tumor.df[rnames.tumor == "285464", ] <- sum.counts.tumor
sum.counts.normal <- normal.df[rnames.normal == "285464", ] + normal.df[rnames.normal == "57654", ]
normal.df[rnames.normal == "285464", ] <- sum.counts.normal
sum.counts.tumor  <- tumor.df[rnames.tumor == "57654", ] + tumor.df[rnames.tumor == "23285", ]
tumor.df[rnames.tumor == "57654", ] <- sum.counts.tumor
sum.counts.normal <- normal.df[rnames.normal == "57654", ] + normal.df[rnames.normal == "23285", ]
normal.df[rnames.normal == "57654", ] <- sum.counts.normal
sum.counts.tumor  <- tumor.df[rnames.tumor == "10715", ] + tumor.df[rnames.tumor == "2657", ]
tumor.df[rnames.tumor == "10715", ] <- sum.counts.tumor
sum.counts.normal <- normal.df[rnames.normal == "10715", ] + normal.df[rnames.normal == "2657", ]
normal.df[rnames.normal == "10715", ] <- sum.counts.normal
sum.counts.tumor  <- tumor.df[rnames.tumor == "2074", ] + tumor.df[rnames.tumor == "267004", ]
tumor.df[rnames.tumor == "2074", ] <- sum.counts.tumor
sum.counts.normal <- normal.df[rnames.normal == "2074", ] + normal.df[rnames.normal == "267004", ]
normal.df[rnames.normal == "2074", ] <- sum.counts.normal
entrez.to.remove <- c("2844", "643314", "3742", "9645", "57654", "23285", "2657", "267004")
tumor.df <- tumor.df[!(rownames(tumor.df) %in% entrez.to.remove), ]
normal.df <- normal.df[!(rownames(normal.df) %in% entrez.to.remove), ]
merged.annot <- merged.annot[!(merged.annot$EntrezId %in% entrez.to.remove), ]
dim(tumor.df)
## [1] 18563   773
dim(normal.df)
## [1] 18563   101
dim(merged.annot)
which(duplicated(merged.annot$EntrezId))
## integer(0)
which(duplicated(merged.annot$EnsemblId))
## DONE!
normal$Counts <- data.matrix(normal.df, rownames.force = F)
## DONE!
merged.annot <- merged.annot[order(merged.annot$Row), ]
head(merged.annot)
?hed
?head
head(merged.annot, n=15L)
head(normal.df)
head(tumor.df)
## Check they're all in the same order
size <- unique(rbind(dim(normal.df), dim(tumor.df))[1])
genes <- cbind(merged.annot$EntrezId, rownames(tumor.df), rownames(normal.df))
genes <- t(unique(t(genes)))
genes
stopifnot(dim(genes)==c(size[1], 1))
col.to.remove <- c("Symbol.y")
merged.annot <- merged.annot[, -col.to.remove]
col.to.remove <- "Symbol.y"
merged.annot <- merged.annot[, -col.to.remove]
merged.annot <- merged.annot[, -9]
setwd("~/Workspace/rnapipeline/tcga-rawcounts-comparison")
annot <- read.delim(file="Biomart_EnsemblG92_GRCh38_p12_NCBI.txt", sep="\t")
names(annot) <- c("EnsemblId", "Chr", "Start", "End", "GC", "Type", "Symbol", "EntrezId")
dim(annot)
## [1] 64927     8
levels(annot$Chr)
annot <- annot[annot$Chr%in%c(as.character(1:22), "X", "Y"),]
annot$Chr <- droplevels(annot$Chr)
table(annot$Chr)
dim(annot)
### Genes with no Symbol
annot.nosymbol <- annot[annot$Symbol=="", ]
annot.nosymbol
dim(annot.nosymbol)
##[1] 20925     8
annot.entrezna <- annot[is.na(annot$EntrezId),]
annot.entrezna
dim(annot.entrezna)
###### Healthy Data Frame
load(file = "cancerRawLegacy.RData")
load(file = "healthyRawLegacy.RData")
normal.df <- data.frame(normal$Counts)
tumor.df <- data.frame(tumor$Counts)
head(normal.df)
dim(normal.df)
head(tumor.df)
dim(tumor.df)
## [1] 20532   773
size <- unique(rbind(dim(normal$Counts), dim(tumor$Counts))[1])
##Check if the genes match positions
genes <- cbind(tumor$Annot[,2], normal$Annot[,2])
genes <- t(unique(t(genes)))
stopifnot(dim(genes) == c(size[1], 1))
rownames(normal.df) <- as.numeric(normal$Annot[,2])
rownames(tumor.df) <- as.numeric(tumor$Annot[,2])
head(normal.df)
head(tumor.df)
head(normal$Annot[,2])
head(tumor$Annot[,2])
setdiff(normal$Annot[,2], tumor$Annot[,2])
## character(0)
all.entrez <- unique(annot$EntrezId)
length(all.entrez)
## Should remove entrez ids that are not in all.entrez
out.entrez.ids <- which(!(rownames(normal.df) %in% all.entrez))
normal.df <- normal.df[-out.entrez.ids, ]
dim(normal.df)
#[1] 18578   101
tumor.df <- tumor.df[-out.entrez.ids, ]
dim(tumor.df)
normal$Annot <- normal$Annot[-out.entrez.ids,]
dim(normal$Annot)
tumor$Annot <- tumor$Annot[-out.entrez.ids, ]
dim(tumor$Annot)
# [1] 18578     2
## Check again
size <- unique(rbind(dim(normal.df), dim(tumor.df))[1])
genes <- cbind(tumor$Annot[,2], normal$Annot[,2], rownames(tumor.df), rownames(normal.df))
genes <- t(unique(t(genes)))
stopifnot(dim(genes)==c(size[1], 1))
################ Merge and remove duplicates
annot.normal <- data.frame(normal$Annot, stringsAsFactors = FALSE)
##Add Biomart data
merged.annot <- merge(x=annot.normal, y=annot, by="EntrezId", all=F, sort=FALSE)
dim(merged.annot)
#[1] 18639     9
merged.annot[duplicated(merged.annot[,c("EntrezId", "EnsemblId")]), ]
duplicated.entrez.ensembl <- merged.annot[duplicated(merged.annot[,c("EntrezId", "EnsemblId")]), c("EntrezId", "EnsemblId")]
duplicated.entrez.ensembl.rows <- merged.annot[merged.annot$EntrezId %in% duplicated.entrez.ensembl$EntrezId |
merged.annot$EnsemblId %in% duplicated.entrez.ensembl$EntrezId, ]
duplicated.entrez.ensembl.rows
ids.to.remove = c("2977", "2978", "2980")
merged.annot[ids.to.remove, ]
merged.annot <- merged.annot[!(rownames(merged.annot) %in% ids.to.remove), ]
dim(merged.annot)
##### Duplicates. EnsemblId
dup.ensembl.ids <- which(duplicated(merged.annot$EnsemblId))
dup.ensembl <- unique(merged.annot[dup.ensembl.ids, "EnsemblId"])
dup.ensembl.rows <- merged.annot[which(merged.annot$EnsemblId %in% dup.ensembl), ]
dim(dup.ensembl.rows)
###[1] 75  9
## We need to remove the duplicated EnsemblIds. Lets keep them but only one Entrez counts should count
## probaby take max
length(unique(dup.ensembl.rows$EntrezId))
## [1] 70
dup.entrez.in.dup.ensembl <- dup.ensembl.rows[which(duplicated(dup.ensembl.rows$EntrezId)), c("EntrezId", "EnsemblId")]
dup.entrez.in.dup.ensembl <- merged.annot[merged.annot$EntrezId %in% dup.entrez.in.dup.ensembl$EntrezId
| merged.annot$EnsemblId %in% dup.entrez.in.dup.ensembl$EnsemblId , ]
dup.entrez.in.dup.ensembl <- dup.entrez.in.dup.ensembl[order(dup.entrez.in.dup.ensembl$EnsemblId, dup.entrez.in.dup.ensembl$EntrezId), ]
dup.entrez.in.dup.ensembl
### Duplicates. Entrez.Ids
dup.entrez.ids <- which(duplicated(merged.annot$EntrezId))
dup.entrez <- unique(merged.annot[dup.entrez.ids, "EntrezId"])
dup.entrez.rows <- merged.annot[which(merged.annot$EntrezId %in% dup.entrez), ]
dim(dup.entrez.rows)
###[1] 117   9
length(unique(dup.ensembl.rows$EnsemblId))
## [1] 35
dup.ensembl.in.dup.entrez <- dup.entrez.rows[which(duplicated(dup.entrez.rows$EnsemblId)), c("EntrezId", "EnsemblId")]
dup.ensembl.in.dup.entrez <- merged.annot[merged.annot$EntrezId %in% dup.ensembl.in.dup.entrez$EntrezId
| merged.annot$EnsemblId %in% dup.ensembl.in.dup.entrez$EnsemblId , ]
dup.ensembl.in.dup.entrez <- dup.ensembl.in.dup.entrez[order(dup.ensembl.in.dup.entrez$EnsemblId, dup.ensembl.in.dup.entrez$EntrezId), ]
identical(dup.ensembl.in.dup.entrez, dup.entrez.in.dup.ensembl)
######################################
## dup.esenbl.in.dup.entrez has 150472 - ENSG00000215126 extra.
## check one by one
dup.ensembl.in.dup.entrez
setdiff(rownames(dup.ensembl.in.dup.entrez), rownames(dup.entrez.in.dup.ensembl))
merged.annot[merged.annot$EnsemblId == "ENSG00000196873", ]
merged.annot["2784", ] <- merged.annot["2785", ]
merged.annot[merged.annot$EnsemblId == "ENSG00000196873", ]
merged.annot[merged.annot$EntrezId == merged.annot["2784", "EntrezId"], ]
merged.annot[merged.annot$EnsemblId == "ENSG00000215126", ]
merged.annot["2788", ] <- merged.annot["2787", ]
merged.annot[merged.annot$EnsemblId == "ENSG00000215126", ]
merged.annot[merged.annot$EntrezId == merged.annot["2788", "EntrezId"] , ]
merged.annot[merged.annot$EnsemblId == "ENSG00000183629", ]
merged.annot["6722", ] <- merged.annot["6721", ]
merged.annot[merged.annot$EnsemblId == "ENSG00000183629", ]
merged.annot[merged.annot$EntrezId == merged.annot["6722", "EntrezId"], ]
merged.annot[merged.annot$EnsemblId == "ENSG00000205076", ]
merged.annot["8946", ] <- merged.annot["8947", ]
merged.annot[merged.annot$EnsemblId == "ENSG00000205076", ]
merged.annot[merged.annot$EntrezId == merged.annot["8946", "EntrezId"], ]
merged.annot[merged.annot$EnsemblId == "ENSG00000153684", ]
merged.annot["6719", ] <- merged.annot["6720", ]
merged.annot[merged.annot$EntrezId == merged.annot["6719", "EntrezId"], ]
merged.annot[merged.annot$EnsemblId == "ENSG00000153684", ]
merged.annot[merged.annot$EnsemblId == "ENSG00000178934", ]
merged.annot["8945", ] <- merged.annot["8944", ]
merged.annot[merged.annot$EnsemblId == "ENSG00000178934", ]
merged.annot[merged.annot$EntrezId == merged.annot["8945", "EntrezId"], ]
merged.annot[merged.annot$EnsemblId == "ENSG00000136682", ]
merged.annot["2783", ] <- merged.annot["2782", ]
merged.annot[merged.annot$EnsemblId == "ENSG00000136682", ]
merged.annot[merged.annot$EntrezId == merged.annot["2783", "EntrezId"], ]
### We can remove Entrezid - Ensemblid duplicates
merged.annot[duplicated(merged.annot), ]
merged.annot <- merged.annot[!duplicated(merged.annot), ]
dim(merged.annot)
##### Duplicates. EnsemblId - Take2
dup.ensembl.ids <- which(duplicated(merged.annot$EnsemblId))
dup.ensembl <-unique(merged.annot[dup.ensembl.ids, "EnsemblId"])
dup.ensembl.rows <- merged.annot[which(merged.annot$EnsemblId %in% dup.ensembl), ]
dim(dup.ensembl.rows)
###[1] 62  9
length(unique(dup.ensembl.rows$EntrezId))
##[1] 62 YEI!!!
dup.ensembl.rows$EntrezId <- as.numeric(dup.ensembl.rows$EntrezId)
dup.ensembl.rows <- dup.ensembl.rows[order(dup.ensembl.rows$EntrezId), ]
dim(dup.ensembl.rows)
## [1] 62  9
dup.ensembl.rows
##write.table(dup.ensembl.rows, file = "dup_ensembl_rows.tsv", quote=F, sep="\t")
### Check one by one
### Remove the ones with no EnsemblId
ids.to.remove = c("6338", "6341", "6340", "6073", "6337", "6339", "6343")
merged.annot[ids.to.remove, ]
merged.annot <- merged.annot[!(rownames(merged.annot) %in% ids.to.remove), ]
dim(merged.annot)
merged.annot[merged.annot$EnsemblId == "ENSG00000160014" & merged.annot$EntrezId == "808", ]
merged.annot["2652",] <- merged.annot["2653",]
merged.annot["2652",]
merged.annot[merged.annot$EnsemblId == "ENSG00000160014", ]
merged.annot[merged.annot$EntrezId == merged.annot["2652", "EntrezId"], ]
merged.annot[merged.annot$EnsemblId == "ENSG00000196735" & merged.annot$EntrezId == "3117", ]
merged.annot["7374",] <- merged.annot["7373",]
merged.annot["7374",]
merged.annot[merged.annot$EnsemblId == "ENSG00000196735", ]
merged.annot[merged.annot$EntrezId == merged.annot["7374", "EntrezId"], ]
merged.annot[merged.annot$EnsemblId == "ENSG00000231887" & merged.annot$EntrezId == "5554", ]
merged.annot["12754",] <- merged.annot["12755", ]
merged.annot["12755", ]
merged.annot[merged.annot$EnsemblId == "ENSG00000231887", ]
merged.annot[merged.annot$EntrezId == merged.annot["12755", "EntrezId"], ]
merged.annot[merged.annot$EnsemblId == "ENSG00000177954" & merged.annot$EntrezId == "6232", ]
merged.annot["13942",] <- merged.annot["13941",]
merged.annot[merged.annot$EnsemblId == "ENSG00000177954", ]
merged.annot[merged.annot$EntrezId == merged.annot["13941", "EntrezId"], ]
merged.annot[merged.annot$EnsemblId == "ENSG00000172062" & merged.annot$EntrezId == "6606", ]
merged.annot["15115",] <- merged.annot["15114",]
merged.annot[merged.annot$EnsemblId == "ENSG00000172062", ]
merged.annot[merged.annot$EntrezId == merged.annot["15115", "EntrezId"] , ]
merged.annot[merged.annot$EnsemblId == "ENSG00000244682" & merged.annot$EntrezId == "9103", ]
merged.annot["5920", "Start"] <- 161581339
merged.annot["5920", "End"] <- 	161605662
merged.annot["5920", "GC"] <- 44.62
merged.annot["5920", "Type"] <- "polymorphic_pseudogene"
merged.annot["5920", "EnsemblId"] <- "ENSG00000244682"
merged.annot["5920", "Symbol.y"] <- "FCGR2C"
merged.annot[merged.annot$EnsemblId == "ENSG00000244682", ]
merged.annot[merged.annot$EntrezId == "9103", ]
merged.annot[merged.annot$EnsemblId == "ENSG00000256060" & merged.annot$EntrezId == "10597", ]
merged.annot["16795",] <- merged.annot["16796",]
merged.annot[merged.annot$EnsemblId == "ENSG00000256060", ]
merged.annot[merged.annot$EntrezId == merged.annot["16795", "EntrezId"] , ]
merged.annot[merged.annot$EnsemblId == "ENSG00000169618" & merged.annot$EntrezId == "10887", ]
merged.annot["12825",]
merged.annot["12825", "EnsemblId"] <- "ENSG00000169618"
merged.annot["12825", "Symbol.y"] <- "PROKR1"
merged.annot["12825", "Start"] <- 68643589
merged.annot["12825", "End"] <- 	68658247
merged.annot["12825", "GC"] <- 46.47
merged.annot[merged.annot$EnsemblId == "ENSG00000169618", ]
merged.annot[merged.annot$EntrezId == "10887", ]
merged.annot[merged.annot$EnsemblId == "ENSG00000144134" & merged.annot$EntrezId == "11159", ]
merged.annot["13253",] <- merged.annot["13254",]
merged.annot[merged.annot$EnsemblId == "ENSG00000144134", ]
merged.annot[merged.annot$EntrezId == merged.annot["13253", "EntrezId"], ]
merged.annot[merged.annot$EnsemblId == "ENSG00000188092" & merged.annot$EntrezId == "51463", ]
merged.annot["6879",] <- merged.annot["6880",]
merged.annot[merged.annot$EnsemblId == "ENSG00000188092", ]
merged.annot[merged.annot$EntrezId == merged.annot["6879", "EntrezId"], ]
merged.annot[merged.annot$EnsemblId == "ENSG00000187272" & merged.annot$EntrezId == "83901", ]
merged.annot["8772",] <- merged.annot["8771",]
merged.annot[merged.annot$EntrezId == merged.annot["8772", "EntrezId"] , ]
merged.annot[merged.annot$EnsemblId == "ENSG00000187272", ]
merged.annot[merged.annot$EnsemblId == "ENSG00000182986" & merged.annot$EntrezId == "162967", ]
merged.annot["18208",] <- merged.annot["18207",]
merged.annot[merged.annot$EnsemblId == "ENSG00000182986", ]
merged.annot[merged.annot$EntrezId == merged.annot["18208", "EntrezId"], ]
merged.annot[merged.annot$EnsemblId == "ENSG00000158427" & merged.annot$EntrezId == "286527", ]
merged.annot["16591",] <- merged.annot["16592",]
merged.annot[merged.annot$EntrezId == merged.annot["16591", "EntrezId"], ]
merged.annot["16593",] <- merged.annot["16592",]
merged.annot[merged.annot$EnsemblId == "ENSG00000158427", ]
merged.annot[merged.annot$EnsemblId == "ENSG00000238269" & merged.annot$EntrezId == "389860", ]
merged.annot["11643",] <- merged.annot["11644",]
merged.annot[merged.annot$EnsemblId == "ENSG00000238269", ]
merged.annot[merged.annot$EntrezId == merged.annot["11643", "EntrezId"] , ]
merged.annot[merged.annot$EnsemblId == "ENSG00000278299" & merged.annot$EntrezId == "414060", ]
merged.annot["15942",] <- merged.annot["15943",]
merged.annot[merged.annot$EnsemblId == "ENSG00000278299", ]
merged.annot[merged.annot$EntrezId == merged.annot["15942", "EntrezId"] , ]
merged.annot[merged.annot$EnsemblId == "ENSG00000268940" & merged.annot$EntrezId == "541466", ]
merged.annot["4078",] <- merged.annot["4077",]
merged.annot[merged.annot$EnsemblId == "ENSG00000268940", ]
merged.annot[merged.annot$EntrezId == merged.annot["4078", "EntrezId"], ]
merged.annot[merged.annot$EnsemblId == "ENSG00000183474" & merged.annot$EntrezId == "728340", ]
merged.annot["7026",] <- merged.annot["7025",]
merged.annot[merged.annot$EntrezId == merged.annot["7026", "EntrezId"] , ]
merged.annot[merged.annot$EnsemblId == "ENSG00000183474", ]
merged.annot[merged.annot$EnsemblId == "ENSG00000099974" & merged.annot$EntrezId == "100037417", ]
merged.annot["4448",] <- merged.annot["4449",]
merged.annot[merged.annot$EnsemblId == "ENSG00000099974", ]
merged.annot[merged.annot$EntrezId == merged.annot["4448", "EntrezId"], ]
all(lapply(as.character(merged.annot$EnsemblId), nchar) == 15)
### Duplicates Ensambl Take 3
merged.annot[duplicated(merged.annot), ]
merged.annot <- merged.annot[!duplicated(merged.annot), ]
dim(merged.annot)
dup.ensembl.ids <- which(duplicated(merged.annot$EnsemblId))
dup.ensembl <-unique(merged.annot[dup.ensembl.ids, "EnsemblId"])
dup.ensembl.rows <- merged.annot[which(merged.annot$EnsemblId %in% dup.ensembl), ]
dim(dup.ensembl.rows)
### [1] 16  9
length(unique(dup.ensembl.rows$EntrezId))
dup.ensembl.rows <- dup.ensembl.rows[order(dup.ensembl.rows$EnsemblId, dup.ensembl.rows$EntrezId), ]
### Duplicated EntrezId
dup.entrez.ids <-which(duplicated(merged.annot$EntrezId))
dup.entrez <- unique(merged.annot[dup.entrez.ids, "EntrezId"])
dup.entrez.rows <- merged.annot[which(merged.annot$EntrezId %in% dup.entrez), ]
dim(dup.entrez.rows)
##write.table(dup.entrez.rows, file = "dup_entrez_rows.tsv", quote=F, sep="\t")
## check manually
ids.to.remove = c("910", "943", "2810", "3957", "4502", "7497", "7758", "8027", "9281", "10507",
"11773", "11904", "11918", "12137", "13275", "13279", "14205", "14234", "14382",
"15945", "16258", "16400", "17924", "18185")
merged.annot[ids.to.remove, ]
merged.annot <- merged.annot[!(rownames(merged.annot) %in% ids.to.remove), ]
dim(merged.annot)
##[1] 18581     9
## Keep the smallest ensemblIds for duplicated entrez
merged.annot$Row <- 1:nrow(merged.annot)
merged.annot <- merged.annot[order(merged.annot$EntrezId, merged.annot$EnsemblId), ]
dup.entrez.ids <-which(duplicated(merged.annot$EntrezId))
length(dup.entrez.ids)
## [1] 10
merged.annot[dup.entrez.ids, ]
merged.annot <- merged.annot[-dup.entrez.ids, ]
dim(merged.annot)
##[1] 18571     9
which(duplicated(merged.annot$EntrezId))
### Before summing the counts for duplicated ensemblIds, remove all the unwanted EntrezId in
### normal.df and tumor.df
tumor.df <- tumor.df[rownames(tumor.df) %in% merged.annot$EntrezId, ]
dim(tumor.df)
## [1] 18571   773
normal.df <- normal.df[rownames(normal.df) %in% merged.annot$EntrezId, ]
dim(normal.df)
rnames.tumor <- rownames(tumor.df)
rnames.normal <- rownames(normal.df)
sum.counts.tumor <- tumor.df[rnames.tumor == "23637", ] + tumor.df[rnames.tumor == "2844", ]
tumor.df[rnames.tumor == "23637", ] <- sum.counts.tumor
sum.counts.normal <- normal.df[rnames.normal == "23637", ] +  normal.df[rnames.normal == "2844", ]
normal.df[rnames.normal == "23637", ] <- sum.counts.normal
sum.counts.tumor  <- tumor.df[rnames.tumor == "23499", ] + tumor.df[rnames.tumor == "643314", ]
tumor.df[rnames.tumor == "23499", ] <- sum.counts.tumor
sum.counts.normal <- normal.df[rnames.normal == "23499", ] + normal.df[rnames.normal == "643314", ]
normal.df[rnames.normal == "23499", ] <- sum.counts.normal
sum.counts.tumor  <- tumor.df[rnames.tumor == "26290", ] + tumor.df[rnames.tumor == "3742", ]
tumor.df[rnames.tumor == "26290", ] <- sum.counts.tumor
sum.counts.normal <- normal.df[rnames.normal == "26290", ] + normal.df[rnames.normal == "3742", ]
normal.df[rnames.normal == "26290", ] <- sum.counts.normal
sum.counts.tumor  <- tumor.df[rnames.tumor == "84953", ] + tumor.df[rnames.tumor == "9645", ]
tumor.df[rnames.tumor == "84953", ] <- sum.counts.tumor
sum.counts.normal <- normal.df[rnames.normal == "84953", ] + normal.df[rnames.normal == "9645", ]
normal.df[rnames.normal == "84953", ] <- sum.counts.normal
sum.counts.tumor  <- tumor.df[rnames.tumor == "285464", ] + tumor.df[rnames.tumor == "57654", ]
tumor.df[rnames.tumor == "285464", ] <- sum.counts.tumor
sum.counts.normal <- normal.df[rnames.normal == "285464", ] + normal.df[rnames.normal == "57654", ]
normal.df[rnames.normal == "285464", ] <- sum.counts.normal
sum.counts.tumor  <- tumor.df[rnames.tumor == "57654", ] + tumor.df[rnames.tumor == "23285", ]
tumor.df[rnames.tumor == "57654", ] <- sum.counts.tumor
sum.counts.normal <- normal.df[rnames.normal == "57654", ] + normal.df[rnames.normal == "23285", ]
normal.df[rnames.normal == "57654", ] <- sum.counts.normal
sum.counts.tumor  <- tumor.df[rnames.tumor == "10715", ] + tumor.df[rnames.tumor == "2657", ]
tumor.df[rnames.tumor == "10715", ] <- sum.counts.tumor
sum.counts.normal <- normal.df[rnames.normal == "10715", ] + normal.df[rnames.normal == "2657", ]
normal.df[rnames.normal == "10715", ] <- sum.counts.normal
sum.counts.tumor  <- tumor.df[rnames.tumor == "2074", ] + tumor.df[rnames.tumor == "267004", ]
tumor.df[rnames.tumor == "2074", ] <- sum.counts.tumor
sum.counts.normal <- normal.df[rnames.normal == "2074", ] + normal.df[rnames.normal == "267004", ]
normal.df[rnames.normal == "2074", ] <- sum.counts.normal
entrez.to.remove <- c("2844", "643314", "3742", "9645", "57654", "23285", "2657", "267004")
tumor.df <- tumor.df[!(rownames(tumor.df) %in% entrez.to.remove), ]
normal.df <- normal.df[!(rownames(normal.df) %in% entrez.to.remove), ]
merged.annot <- merged.annot[!(merged.annot$EntrezId %in% entrez.to.remove), ]
dim(tumor.df)
## [1] 18563   773
dim(normal.df)
## [1] 18563   101
dim(merged.annot)
which(duplicated(merged.annot$EntrezId))
## integer(0)
which(duplicated(merged.annot$EnsemblId))
## DONE!
merged.annot <- merged.annot[order(merged.annot$Row), ]
head(merged.annot, n=15L)
head(normal.df)
head(tumor.df)
## Check they're all in the same order
size <- unique(rbind(dim(normal.df), dim(tumor.df))[1])
genes <- cbind(merged.annot$EntrezId, rownames(tumor.df), rownames(normal.df))
genes <- t(unique(t(genes)))
stopifnot(dim(genes)==c(size[1], 1))
normal$Counts <- data.matrix(normal.df, rownames.force = F)
normal$Annot <- merged.annot$EnsemblId
tumor$Counts <- data.matrix(tumor.df, rownames.force = F)
tumor$Annot <- merged.annot$EnsemblId
merged.annot <- merged.annot[, -2]
merged.annot <- merged.annot[, -9]
colnames(merged.annot) <- c("EntrezId", "EnsemblId", "Chr", "Start", "End", "GC", "Type", "Symbol")
save(merged.annot, file="annotEntrez.RData", compress="xz")
save(normal, file="healthyRawLegacy.RData", compress="xz")
save(tumor, file="cancerRawLegacy.RData", compress="xz")
save(tumor, file="cancerRawLegacy.RData", compress="xz")
